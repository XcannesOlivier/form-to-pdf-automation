üü° placeholders

R√¥le

Ce n≈ìud est un n≈ìud Code (JavaScript) en mode Run Once for All Items.
Il transforme le rapport structur√© de Build_report en un dictionnaire de placeholders 
(cl√© ‚Üí valeur) qui seront remplac√©s dans le mod√®le Google Slides/PDF.



Fonctionnement du script


1) Entr√©e

---------------------------
const report = $json || {};
---------------------------

 . R√©cup√®re le rapport g√©n√©r√© par Build_report.



2) Helper pour formatage en %

-----------------------------------------
function pctFmt(n) {
  return `${Number(n || 0).toFixed(0)}%`;
}
-----------------------------------------

 . Formate les nombres en pourcentages arrondis (ex : 59 ‚Üí 59%).



3) Initialisation du dictionnaire

------------------------
const placeholders = {};
------------------------

 . Objet final qui contiendra toutes les paires cl√©/valeur.



4) Placeholders globaux

-------------------------------------------------------------
placeholders["DATE"]       = report.horodateur || "";
placeholders["GLOBAL_PCT"] = pctFmt(report.global?.pct || 0);
placeholders["EMAIL"]      = report.email || "";
-------------------------------------------------------------

 . DATE ‚Üí Horodateur de la r√©ponse.

 . GLOBAL_PCT ‚Üí Score global format√© en %.

 . EMAIL ‚Üí Email du participant.



5) Placeholders des sessions

----------------------------------------------------------------
if (Array.isArray(report.sessions)) {
  for (const s of report.sessions) {
    const sid = s.id; // "1".."4"

    placeholders[`S${sid}_TITLE`] = s.label || `Session ${sid}`;
    placeholders[`S${sid}_PCT`]   = pctFmt(s.total_pct || 0);
----------------------------------------------------------------

 . Pour chaque session (S1, S2, S3, S4) :

    . Sx_TITLE ‚Üí Nom de la session (ex. Session 1).

    . Sx_PCT ‚Üí Pourcentage de r√©ussite de la session.



6) Placeholders des sous-th√®mes

--------------------------------------------------------------------------
if (Array.isArray(s.subthemes)) {
  s.subthemes.forEach((st, i) => {
    const n = i + 1;
    placeholders[`S${sid}_SUB${n}_TITLE`] = st.label || `Sous-th√®me ${n}`;
    placeholders[`S${sid}_SUB${n}_PCT`]   = pctFmt(st.pct || 0);
    placeholders[`S${sid}_SUB${n}_STARS`] = st.stars || "";
    placeholders[`S${sid}_SUB${n}_BILAN`] = st.bilan || "";
  });
}
--------------------------------------------------------------------------


 . Pour chaque sous-th√®me de la session :

    . Sx_SUBn_TITLE ‚Üí Nom du sous-th√®me.

    . Sx_SUBn_PCT ‚Üí Pourcentage obtenu.

    . Sx_SUBn_STARS ‚Üí √âtoiles ‚òÖ.

    . Sx_SUBn_BILAN ‚Üí Texte du bilan (niveau + conseils personnalis√©s).



Exemple :

#############################################################################################
{
  "S1_SUB1_TITLE": "Navigation & Internet",   ## Eemple (Not Use) ##
  "S1_SUB1_PCT": "50%",
  "S1_SUB1_STARS": "‚òÖ‚òÜ‚òÜ",
  "S1_SUB1_BILAN": "Bases fragiles : comprendre navigateur, recherche, diff√©rence email/URL."
}
##############################################################################################


7) Sortie

----------------
return [{
  json: {
    placeholders
  }
}];
----------------

 . La sortie est un objet unique contenant toutes les cl√©s pr√™tes √† remplacer dans Google Slides/Docs.



Exemple de sortie

#############################################################################################
{
  "DATE": "14/09/2025 00:36:15",
  "GLOBAL_PCT": "59%",
  "EMAIL": "exemple@mail.com",
  "S1_TITLE": "Session 1",
  "S1_PCT": "55%",
  "S1_SUB1_TITLE": "Navigation & Internet",
  "S1_SUB1_PCT": "50%",
  "S1_SUB1_STARS": "‚òÖ‚òÜ‚òÜ",
  "S1_SUB1_BILAN": "Bases fragiles : comprendre navigateur, recherche, diff√©rence email/URL."
}
##############################################################################################



Points cl√©s

 . ‚úÖ Centralise toutes les donn√©es utiles sous un format cl√©/valeur simple.

 . ‚úÖ Compatible avec les mod√®les Google Slides/Docs gr√¢ce aux {{PLACEHOLDERS}}.

 . ‚úÖ Prend en charge sessions + sous-th√®mes.

 . ‚ö†Ô∏è Les cl√©s doivent correspondre exactement aux placeholders d√©finis dans le mod√®le (par ex. {{S1_SUB1_TITLE}}).