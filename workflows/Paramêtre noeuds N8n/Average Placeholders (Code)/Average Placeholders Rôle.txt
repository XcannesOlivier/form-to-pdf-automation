üîµ Average Placeholders

R√¥le

Ce n≈ìud est un n≈ìud Code (JavaScript) en mode Run Once for All Items.
Il prend en entr√©e les lignes issues du n≈ìud Get row(s) in sheet (qui contient les moyennes calcul√©es par sous-th√®me ou par session), 
et les transforme en placeholders utilisables dans le rapport final.


Fonctionnement du script


1) Entr√©e

-------------------------------------------------
const rows = $input.all().map(item => item.json);
-------------------------------------------------

 . R√©cup√®re toutes les lignes fournies par Google Sheets.

 . Chaque ligne contient :

#################################################
{
  "row_number": 2,
  "cl√©": "S1_SUB1_AVG",
  "somme": 550,           ## Exemple (Not Use) ##
  "n": 7,
  "moyenne": 81
}
#################################################



2) Helper pour formatage %

-----------------------------------------
function pctFmt(n) {
  return `${Number(n || 0).toFixed(0)}%`;
}
-----------------------------------------

 . Transforme une valeur num√©rique en pourcentage arrondi (ex. 81 ‚Üí 81%).




3) Construction du dictionnaire

--------------------------------------------
const placeholders = {};

for (const r of rows) {
  if (r.cl√© && r.moyenne !== undefined) {
    placeholders[r.cl√©] = pctFmt(r.moyenne);
  }
}
--------------------------------------------


 . V√©rifie que la ligne contient une cl√© et une moyenne.

 . Exemple : si cl√© = "S1_SUB1_AVG" et moyenne = 81, alors :

############################################
"S1_SUB1_AVG": "81%" ## Exemple (Not Use) ##
############################################



4) Sortie

-----------------
return [{
  json: {
    placeholders
  }
}];
-----------------

 . Produit un seul objet avec toutes les moyennes format√©es.

Exemple de Sortie

#################################################
{
  "placeholders": {
    "S1_SUB1_AVG": "81%",
    "S1_SUB2_AVG": "75%",
    "S1_SUB3_AVG": "87%",
    "S2_SUB1_AVG": "74%",
    "S2_SUB2_AVG": "80%",
    "S3_SUB1_AVG": "70%", ## Exemple (Not Use) ##
    "S3_SUB2_AVG": "85%",
    "S3_SUB3_AVG": "79%",
    "S4_SUB1_AVG": "91%",
    "S4_SUB2_AVG": "76%",
    "S4_SUB3_AVG": "68%"
  }
}
##################################################




Fonctionnement dans le workflow

 1- Get row(s) in sheet lit les moyennes stock√©es dans Google Sheets.

 2- Average Placeholders convertit ces moyennes en placeholders format√©s.

 3- Merge Placeholders fusionne ces donn√©es avec les placeholders individuels (issus de placeholders) 
 pour construire un dictionnaire complet (individu + groupe).




Points cl√©s

 . ‚úÖ Facilite la comparaison entre score individuel et moyenne du groupe.

 . ‚úÖ G√©n√®re des cl√©s standardis√©es (Sx_SUBy_AVG).

 . ‚úÖ Compatible directement avec les mod√®les Google Slides/Docs.

 . ‚ö†Ô∏è Les cl√©s de la feuille Google Sheets doivent √™tre coh√©rentes avec les placeholders attendus.