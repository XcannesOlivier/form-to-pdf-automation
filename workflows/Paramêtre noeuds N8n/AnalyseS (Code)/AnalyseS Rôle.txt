ðŸŸ  AnalyseS

RÃ´le

Ce nÅ“ud est un nÅ“ud Code (JavaScript) en mode Run Once for All Items.


Il transforme les rÃ©ponses du participant en rÃ©sultats chiffrÃ©s :

 . Score total et score maximum possible

 . Pourcentage de rÃ©ussite et niveau (dÃ©butant, intermÃ©diaire, avancÃ©)

 . RÃ©partition par blocs de 10 questions (q01â€“q10, q11â€“q20, q21â€“q30, q31â€“q40)

 . DÃ©tails de chaque question (rÃ©ponses choisies, score obtenu, score max, thÃ¨me associÃ©)




Fonctionnement du script


1) Normalisation des textes

-----------------------------------
const norm = (s) => String(s ?? "")
  .normalize("NFD")
  .replace(/\p{Diacritic}/gu, "")
  .replace(/[â€œâ€Â«Â»"']/g, "")
  .replace(/\s+/g, " ")
  .trim()
  .toLowerCase();
-----------------------------------

 . Supprime les accents, espaces multiples, guillemets â†’ comparaison plus robuste.

 . Permet de matcher les rÃ©ponses mÃªme si elles diffÃ¨rent lÃ©gÃ¨rement en Ã©criture.




2) Initialisation des donnÃ©es

--------------------------------------------------------------------------
const input = items[0].json;
const rules = input.rules;
if (!rules) {
  return [{ json: { error: "Aucune rÃ¨gle trouvÃ©e dans input.rules" } }];
}

const thresholds = rules.thresholds || { beginner: 40, intermediate: 70 };
const questions = rules.questions || [];
const horodateur = input["Horodateur"] || null;
const email = input["Adresse e-mail"] || "";
--------------------------------------------------------------------------

 . RÃ©cupÃ¨re le barÃ¨me (rules) du nÅ“ud Scoring System.

 . DÃ©finit les seuils des niveaux.

 . Capture lâ€™horodateur et lâ€™email pour traÃ§abilitÃ©.



3) Retrouver les rÃ©ponses donnÃ©es

-------------------------------------------------------------------------------
function findAnswers(label) {
  const needle = norm(label);
  for (const k of Object.keys(input)) {
    if (k.endsWith("__arr") && norm(k.replace("__arr", "")).includes(needle)) {
      return input[k];
    }
  }
  console.log("ðŸ”Ž No match for:", needle, "in keys:", Object.keys(input));
  return [];
}
--------------------------------------------------------------------------------

 . Recherche la question correspondante dans lâ€™input.

 . Retourne les rÃ©ponses choisies (sous forme de tableau).



4) Boucle sur toutes les questions

 . Pour chaque question, le script :

    1- RÃ©cupÃ¨re les rÃ©ponses donnÃ©es.

    2- Compare aux options possibles (options) et calcule le score.

    3- Limite le score Ã  la valeur max autorisÃ©e.

    4- Ajoute le score au total global.

    5- Range le rÃ©sultat dans le bon bloc de 10 questions.

    6- Stocke un dÃ©tail complet (utile pour les bilans personnalisÃ©s).


Exemple de dÃ©tail :


#################################################################
{
  "key": "q7",                          ## Exemple (Not Use) ##
  "label": "reconnaÃ®tre si un fichier",
  "theme": "bases_informatique",
  "answers": ["En regardant son extension (.jpg; .docx; .mp4)"],
  "score": 1,
  "max": 1
}
#################################################################



5) Calculs finaux

-----------------------------------------------------------------------------
const percent = totalMax > 0 ? Math.round((totalScore / totalMax) * 100) : 0;
let level = "advanced";
if (percent < thresholds.beginner) level = "beginner";
else if (percent < thresholds.intermediate) level = "intermediate";
-----------------------------------------------------------------------------

 . Pourcentage = (score / max) * 100.

 . Niveau basÃ© sur les seuils (beginner, intermediate, sinon advanced).




6) Sortie structurÃ©e

------------------------------------
return [{
  json: {
    horodateur,
    email,
    total_score: totalScore,
    total_max: totalMax,
    percent,
    level,
    blocks: {
      q01_q10: blocInfo("q01_q10"),
      q11_q20: blocInfo("q11_q20"),
      q21_q30: blocInfo("q21_q30"),
      q31_q40: blocInfo("q31_q40"),
    },
    details
  }
}];
-------------------------------------


Exemple de sortie :

############################################################
{
  "horodateur": "14/09/2025 00:36:15",
  "email": "exemple@mail.com",
  "total_score": 70.5,
  "total_max": 119.5,        ## Exemple (Not Use) ##
  "percent": 59,
  "level": "intermediate",
  "blocks": {
    "q01_q10": { "score": 14.5, "max": 26.5, "percent": 55 },
    "q11_q20": { "score": 18, "max": 27.5, "percent": 65 },
    "q21_q30": { "score": 20, "max": 31.5, "percent": 63 },
    "q31_q40": { "score": 18, "max": 34, "percent": 53 }
  },
  "details": [...]
}
###############################################################



Points clÃ©s

 . âœ… Normalisation des rÃ©ponses â†’ tolÃ©rant aux variations.

 . âœ… Gestion fine des blocs pour analyser la progression.

 . âœ… Stockage des dÃ©tails â†’ utile pour rapports personnalisÃ©s (PDF/Slides).

 . âš ï¸ DÃ©pend fortement de la cohÃ©rence entre le JSON du barÃ¨me et les libellÃ©s des rÃ©ponses.