{
  "name": "Form ‚Üí PDF v",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "documentId": {
          "__rl": true,
          "value": "1hIa_GGiZ8UbRU_sjZev1f-Kxo7PQuwBcvuYUs5QRiO0",
          "mode": "list",
          "cachedResultName": "√âvaluez vos comp√©tences num√©riques (r√©ponses)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hIa_GGiZ8UbRU_sjZev1f-Kxo7PQuwBcvuYUs5QRiO0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 438541832,
          "mode": "list",
          "cachedResultName": "R√©ponses au formulaire 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hIa_GGiZ8UbRU_sjZev1f-Kxo7PQuwBcvuYUs5QRiO0/edit#gid=438541832"
        },
        "event": "rowAdded",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTrigger",
      "typeVersion": 1,
      "position": [
        -800,
        -32
      ],
      "id": "6ff259de-4d58-4508-b86f-241b4ccded31",
      "name": "Google Sheets Trigger",
      "credentials": {
        "googleSheetsTriggerOAuth2Api": {
          "id": "73PTkCic3IGSpae7",
          "name": "Google Sheets Trigger account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const report = $json.placeholders || {};   // on cible bien l'objet avec S1_SUBx_PCT\n\n// Palette couleurs par session\nconst colors = {\n  S1: \"rgba(75,192,192,1)\",   // vert\n  S2: \"rgba(255,99,132,1)\",   // rouge\n  S3: \"rgba(255,159,64,1)\",   // orange\n  S4: \"rgba(54,162,235,1)\",   // bleu\n};\n\n// Graphe comparatif (barres par sous-sections)\nfunction compareUrl(sectionId, labels, valuesUser, valuesAvg, colorUser) {\n  return `https://quickchart.io/chart?c=${encodeURIComponent(JSON.stringify({\n    type: 'bar',\n    data: {\n      labels,\n      datasets: [\n        {\n          label: 'Vos r√©sultats',\n          data: valuesUser,\n          backgroundColor: colorUser\n        },\n        {\n          label: 'Moyenne',\n          data: valuesAvg,\n          backgroundColor: 'rgba(128,128,128,0.7)'\n        }\n      ]\n    },\n   \n  }))}`;\n}\n\n// Graphe radar global\nfunction radarUrl(labels, values) {\n  return `https://quickchart.io/chart?c=${encodeURIComponent(JSON.stringify({\n    type: 'radar',\n    data: {\n      labels,\n      datasets: [\n        {\n          label: 'Vos r√©sultats globaux',\n          data: values,\n          backgroundColor: 'rgba(54, 162, 235, 0.4)',\n          borderColor: 'rgba(54, 162, 235, 1)',\n          pointBackgroundColor: 'rgba(54, 162, 235, 1)'\n        }\n      ]\n    },\n    options: {\n      scales: {\n        r: { min: 0, max: 100, ticks: { stepSize: 20 } }\n      },\n      plugins: {\n        title: { display: true, text: 'Vue d‚Äôensemble' }\n      }\n    }\n  }))}`;\n}\n\n// Graphe progress bar par session (avec type progressBar)\nfunction progressUrl(sessionId, pct, color) {\n  return `https://quickchart.io/chart?c=${encodeURIComponent(JSON.stringify({\n    type: 'progressBar',\n    data: {\n      datasets: [\n        {\n          data: [pct],\n          backgroundColor: color\n        }\n      ]\n    },\n    options: {\n      plugins: {\n        datalabels: {\n          display: true,\n          formatter: (val) => val + '%'\n        }\n      }\n    }\n  }))}&width=1250&height=70`;\n}\n\nconst out = {};\n\n// Graphiques par sous-sections (barres comparatives + progress bars)\nfor (let i = 1; i <= 4; i++) {\n  const key = `S${i}`;\n  // Mapping des sous-sections par section\nconst sectionLabels = {\n  S1: [\"Navigation & Internet\", \"Logiciels & S√©curit√©\", \"Gestion des fichiers\"],\n  S2: [\"Emails & messagerie\", \"Cloud & outils collaboratifs\", \"R√©seaux sociaux & visioconf√©rence\"],\n  S3: [\"Protection contre les menaces\", \"Mots de passe & authentification\", \"Vie priv√©e & conformit√©\"],\n  S4: [\"Services & usages en ligne\", \"Information & actualit√© num√©rique\", \"Programmation & intelligence artificielle\"]\n};\n\n// R√©cup√®re les bons labels pour la section courante\nconst labels = sectionLabels[key] || [\n  \"Sous-section 1\", \n  \"Sous-section 2\", \n  \"Sous-section 3\"\n];\n\n// Les valeurs utilisateur restent identiques\nconst valuesUser = [\n  Number(String(report[`${key}_SUB1_PCT`] || \"0\").replace(\"%\",\"\")),\n  Number(String(report[`${key}_SUB2_PCT`] || \"0\").replace(\"%\",\"\")),\n  Number(String(report[`${key}_SUB3_PCT`] || \"0\").replace(\"%\",\"\"))\n];\n\n  const valuesAvg = [\n    Number(String(report[`${key}_SUB1_AVG`] || \"0\").replace(\"%\",\"\")),\n    Number(String(report[`${key}_SUB2_AVG`] || \"0\").replace(\"%\",\"\")),\n    Number(String(report[`${key}_SUB3_AVG`] || \"0\").replace(\"%\",\"\"))\n  ];\n\n  const colorUser = colors[key];\n\n  // Graphe comparatif\n  out[`${key}_GRAPH_IMG`] = compareUrl(i, labels, valuesUser, valuesAvg, colorUser);\n\n  // Progress bar style plein\n  const sessionPct = Number(String(report[`${key}_PCT`] || \"0\").replace(\"%\",\"\"));\n  out[`${key}_PROGRESS_IMG`] = progressUrl(i, sessionPct, colorUser);\n}\n\n// Graphe radar global\nconst radarLabels = [\"Comp√©tences num√©riques de base\", \"Communication & collaboration enligne\", \"S√©curit√© num√©rique & protection des donn√©es\", \"Culture num√©rique & usages avanc√©s\"];\nconst radarValues = radarLabels.map((_, i) => {\n  const sid = i + 1;\n  return Number(String(report[`S${sid}_PCT`] || \"0\").replace(\"%\",\"\"));\n});\nout[\"GLOBAL_RADAR_IMG\"] = radarUrl(radarLabels, radarValues);\n\nreturn [{ json: out }];\n\n\n\n\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        944,
        -192
      ],
      "id": "f6156ac0-51d2-4fd9-87c6-e62fe99871f5",
      "name": "Graph URL create"
    },
    {
      "parameters": {
        "url": "=https://slides.googleapis.com/v1/presentations/{{ $json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSlidesOAuth2Api",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -368,
        288
      ],
      "id": "f72ee6a0-a59d-4122-9747-63c69726bf91",
      "name": "HTTP Request Get Slides",
      "credentials": {
        "googleSlidesOAuth2Api": {
          "id": "E3TaKdjZxMYsSCJu",
          "name": "Google Slides account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Entr√©e = sortie directe de build_report\nconst report = $json || {};\n\n// helper pour formater %\nfunction pctFmt(n) {\n  return `${Number(n || 0).toFixed(0)}%`;\n}\n\n// Dictionnaire final\nconst placeholders = {};\n\n// --- Valeurs globales ---\nplaceholders[\"DATE\"]       = report.horodateur || \"\";\nplaceholders[\"GLOBAL_PCT\"] = pctFmt(report.global?.pct || 0);\nplaceholders[\"EMAIL\"]      = report.email || \"\";\n\n// --- Sessions ---\nif (Array.isArray(report.sessions)) {\n  for (const s of report.sessions) {\n    const sid = s.id; // \"1\"..\"4\"\n\n    placeholders[`S${sid}_TITLE`] = s.label || `Session ${sid}`;\n    placeholders[`S${sid}_PCT`]   = pctFmt(s.total_pct || 0);\n\n    if (Array.isArray(s.subthemes)) {\n      s.subthemes.forEach((st, i) => {\n        const n = i + 1;\n        placeholders[`S${sid}_SUB${n}_TITLE`] = st.label || `Sous-th√®me ${n}`;\n        placeholders[`S${sid}_SUB${n}_PCT`]   = pctFmt(st.pct || 0);\n        placeholders[`S${sid}_SUB${n}_STARS`] = st.stars || \"\";\n        placeholders[`S${sid}_SUB${n}_BILAN`] = st.bilan || \"\";\n      });\n    }\n  }\n}\n\n// --- Sortie ---\nreturn [{\n  json: {\n    placeholders\n  }\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        432,
        -32
      ],
      "id": "4b20540b-73f5-46f1-a3fc-c93c8e4ab90f",
      "name": "placeholders"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1oDUWSDawVysqbjnPYOmhAFVy5UL9QHXJ0w3kde82Wp4",
          "mode": "list",
          "cachedResultName": "moyennes_subthemes-questionnaires",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oDUWSDawVysqbjnPYOmhAFVy5UL9QHXJ0w3kde82Wp4/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Feuille 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oDUWSDawVysqbjnPYOmhAFVy5UL9QHXJ0w3kde82Wp4/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        176,
        -208
      ],
      "id": "88635ae6-8179-4192-89ef-75a3083c5be8",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Ue35529pkyLWfv2v",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('placeholders').item.json.placeholders.EMAIL }}",
        "subject": "R√©sultats de votre test de comp√©tences num√©riques",
        "emailType": "text",
        "message": "Bonjour ,  Merci d‚Äôavoir compl√©t√© le test de comp√©tences num√©riques. Vous trouverez en pi√®ce jointe votre rapport personnalis√© au format PDF.  Ce rapport contient :  Votre score global et votre niveau  Un d√©tail par th√®me et sous-th√®me  Des conseils pratiques pour progresser  Nous vous invitons √† consulter attentivement vos r√©sultats et √† suivre les recommandations afin de renforcer vos comp√©tences num√©riques.  Si vous avez des questions ou besoin d‚Äôaccompagnement, n‚Äôh√©sitez pas √† r√©pondre √† ce mail.  Bien cordialement, ",
        "options": {
          "attachmentsUi": {
            "attachmentsBinary": [
              {}
            ]
          }
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        640,
        288
      ],
      "id": "c8b1e036-823c-4b08-806a-bf06d9ec7236",
      "name": "Send a message",
      "webhookId": "27b1f598-f16f-408a-9835-c246d0dc71bd",
      "credentials": {
        "gmailOAuth2": {
          "id": "RXlBls0Jv5PoRDJy",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://slides.googleapis.com/v1/presentations/{{ $('Copy File Slide Model').item.json.id }}:batchUpdate\n",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSlidesOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"requests\": [\n     {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S1_BAR_IMG1.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S1_PROGRESS_IMG }}\"\n      }\n     },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S2_BAR_IMG1.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S2_PROGRESS_IMG }}\"\n      }\n     },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S3_BAR_IMG1.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S3_PROGRESS_IMG }}\"\n      }\n     },\n     {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S4_BAR_IMG1.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S4_PROGRESS_IMG }}\"\n      }\n     },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S1_BAR_IMG.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S1_PROGRESS_IMG }}\"\n      }\n     },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S2_BAR_IMG.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S2_PROGRESS_IMG }}\"\n      }\n     },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S3_BAR_IMG.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S3_PROGRESS_IMG }}\"\n      }\n     },\n     {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S4_BAR_IMG.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S4_PROGRESS_IMG }}\"\n      }\n     },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.RADAR_IMG.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.GLOBAL_RADAR_IMG }}\"\n      }\n     },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S1_GRAPH_IMG.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S1_GRAPH_IMG }}\"\n      }\n    },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S2_GRAPH_IMG.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S2_GRAPH_IMG }}\"\n      }\n    },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S3_GRAPH_IMG.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S3_GRAPH_IMG }}\"\n      }\n    },\n    {\n      \"replaceImage\": {\n        \"imageObjectId\": \"{{ $json.images.S4_GRAPH_IMG.objectId }}\",\n        \"imageReplaceMethod\": \"CENTER_INSIDE\",\n        \"url\": \"{{ $('Graph URL create').item.json.S4_GRAPH_IMG }}\"\n      }\n    },\n     {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(DATE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.DATE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(GLOBAL_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.GLOBAL_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(EMAIL)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.EMAIL }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB1_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB1_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB1_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB1_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB1_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB1_STARS }}\"\n      }\n     },\n     {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB1_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB1_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB2_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB2_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB2_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB2_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB2_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB2_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB2_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB2_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB3_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB3_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB3_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB3_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB3_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB3_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S1_SUB3_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S1_SUB3_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB1_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB1_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB1_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB1_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB1_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB1_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB1_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB1_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB2_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB2_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB2_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB2_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB2_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB2_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB2_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB2_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB3_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB3_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB3_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB3_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB3_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB3_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S2_SUB3_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S2_SUB3_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB1_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB1_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB1_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB1_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB1_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB1_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB1_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB1_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB2_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB2_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB2_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB2_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB2_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB2_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB2_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB2_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB3_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB3_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB3_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB3_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB3_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB3_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S3_SUB3_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S3_SUB3_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB1_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB1_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB1_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB1_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB1_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB1_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB1_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB1_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB2_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB2_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB2_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB2_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB2_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB2_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB2_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB2_BILAN }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB3_TITLE)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB3_TITLE }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB3_PCT)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB3_PCT }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB3_STARS)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB3_STARS }}\"\n      }\n    },\n    {\n      \"replaceAllText\": {\n        \"containsText\": { \"text\": \"(S4_SUB3_BILAN)\", \"matchCase\": true },\n        \"replaceText\": \"{{ $('placeholders').item.json.placeholders.S4_SUB3_BILAN }}\"\n      }\n    }\n  ]\n}\n\n\n\n\n\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        144,
        288
      ],
      "id": "2f134235-442d-4a06-b9e0-131cb7394beb",
      "name": "Http Request Post Slides",
      "credentials": {
        "googleSlidesOAuth2Api": {
          "id": "E3TaKdjZxMYsSCJu",
          "name": "Google Slides account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Entr√©e : sortie brute du HTTP Request Get Slides\nconst slides = $json.slides || [];\n\n// Dictionnaire final\nconst images = {};\n\n// Parcours des slides et des objets\nfor (const slide of slides) {\n  for (const el of (slide.pageElements || [])) {\n    // On garde uniquement ceux dont le titre finit par .png\n    if (el.title && el.title.endsWith(\".png\")) {\n      // Ex : titre \"S1_GRAPH_IMG.png\" ‚Üí cl√© \"S1_GRAPH_IMG\"\n      const key = el.title.replace(\".png\", \"\");\n      images[key] = {\n        objectId: el.objectId,\n        altText: el.title\n      };\n    }\n  }\n}\n\n// Sortie unique\nreturn [{\n  json: {\n    images\n  }\n}];\n\n\n\n\n  "
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -144,
        288
      ],
      "id": "e2c76705-41ae-4856-b1ef-eeecb82d1d83",
      "name": "Extract images from slides"
    },
    {
      "parameters": {
        "url": "=https://docs.google.com/presentation/d/{{ $json.presentationId }}/export/pdf\n",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSlidesOAuth2Api",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        432,
        288
      ],
      "id": "b6ebaa5d-0dc8-48bc-9bda-66d51618a796",
      "name": "HTTP Request Transform PDF",
      "credentials": {
        "googleSlidesOAuth2Api": {
          "id": "E3TaKdjZxMYsSCJu",
          "name": "Google Slides account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ================= Helpers =================\nconst pct   = (s, m) => (m ? +(100 * s / m).toFixed(1) : 0);\nconst stars = (p) => p < 40 ? \"‚òÖ‚òÜ‚òÜ\" : p < 70 ? \"‚òÖ‚òÖ‚òÜ\" : \"‚òÖ‚òÖ‚òÖ\";\n\n// Bilan g√©n√©rique (fallback)\nconst genericBilan = (p) =>\n  p < 40 ? \"Niveau √† consolider : reprenez les bases essentielles.\"\n: p < 70 ? \"Bon socle : poursuivez des exercices cibl√©s pour progresser.\"\n         : \"Tr√®s bonne ma√Ætrise : continuez avec des cas plus avanc√©s.\";\n\nconst levelFromPct = (p) =>\n  p < 40 ? \"D√©butant\" : p < 60 ? \"En progr√®s\" : p < 80 ? \"Comp√©tent\" : \"Expert\";\n\nconst levelKey = (p) =>\n  p < 40 ? \"debutant\" : p < 60 ? \"en_progres\" : p < 80 ? \"competent\" : \"expert\";\n\n// ================= Bilans sp√©cifiques par sous-th√®me =================\n// Cl√© = `${sessionId}:${partId}`  ‚Üí  \"1:1\" .. \"4:3\"\nconst BILANS = {\n  // Session 1\n  \"1:1\": { // Navigation & Internet\n    debutant:   \"Bases fragiles : comprendre navigateur, recherche, diff√©rence email/URL.\",\n    en_progres: \"Bases acquises mais confusions sur URL/email/moteur. Continue √† explorer.\",\n    competent:  \"Formulaires, t√©l√©chargements, onglets multiples. D√©couvre extensions et r√©glages.\",\n    expert:     \"Bonne ma√Ætrise : recherche efficace, distinction email/web. Poursuis avec favoris/onglets.\",\n  },\n  \"1:2\": { // Logiciels & S√©curit√©\n    debutant:   \"Difficult√©s : mises √† jour, copier-coller, pi√®ces jointes s√©curis√©es.\",\n    en_progres: \"Bonnes bases, mais automatismes √† renforcer (MAJ, copier-coller, PJ s√ªres).\",\n    competent:  \"Param√®tres, d√©sinstallation propre, partage de PJ lourdes par lien.\",\n    expert:     \"√Ä l‚Äôaise avec MAJ, copier-coller, PJ. Explore raccourcis et formats de fichiers.\",\n  },\n  \"1:3\": { // Fichiers & Organisation\n    debutant:   \"Difficult√©s : distinguer appareils, types de fichiers, cr√©er dossier, enregistrer.\",\n    en_progres: \"Bonnes intuitions, mais progresse sur organisation : dossiers, extensions, emplacements.\",\n    competent:  \"Nommage standard, tri par type, recherche avanc√©e.\",\n    expert:     \"Bonne ma√Ætrise : fichiers, dossiers, enregistrement. Explore sauvegardes et cloud.\",\n  },\n\n  // Session 2\n  \"2:1\": { // Emails & messagerie\n    debutant:   \"Fragile : antivirus, liens/PJ dangereux, mots de passe, verrouillage appareil.\",\n    en_progres: \"R√©flexes acquis mais erreurs. Varie les mots de passe, verrouille et reste vigilant.\",\n    competent:  \"Utilise mod√®les, CC/Cci correctement, partage PJ lourdes par lien.\",\n    expert:     \"Bon r√©flexes : phishing, mots de passe vari√©s, protection appareil. Sensibilise ton entourage.\",\n  },\n  \"2:2\": { // Cloud & collaboratif\n    debutant:   \"Pas de r√©flexes s√©curit√© : attention SMS suspects, d√©couvre 2FA et gestion donn√©es.\",\n    en_progres: \"Pratiques utiles mais √† renforcer : active 2FA, ma√Ætrise donn√©es et signalements.\",\n    competent:  \"Permissions fines, mod√®les d‚Äô√©quipe, int√©grations Drive/Docs/Calendar.\",\n    expert:     \"R√©flexes solides : 2FA, gestion donn√©es, r√©action aux SMS frauduleux. Bravo.\",\n  },\n  \"2:3\": { // R√©seaux sociaux & visioconf\n    debutant:   \"Bases manquantes : MAJ r√©guli√®res, connexion https.\",\n    en_progres: \"R√©flexes partiels : active MAJ auto, v√©rifie cadenas https.\",\n    competent:  \"Animation, mod√©ration, netiquette.\",\n    expert:     \"Bonne pratique : MAJ r√©guli√®res, connexions s√©curis√©es. V√©rifie aussi sur mobile.\",\n  },\n\n  // Session 3\n  \"3:1\": { // Protection menaces\n    debutant:   \"Rep√®re liens/PJ suspects ; scan antivirus si doute.\",\n    en_progres: \"Identifie phishing/SMS frauduleux, signale (33700), change mots de passe.\",\n    competent:  \"2FA g√©n√©ralis√©e, MAJ rapides, sensibilise entourage.\",\n    expert:     \"Proc√©dures incidents, sauvegardes chiffr√©es, outils anti-phishing, veille.\",\n  },\n  \"3:2\": { // Mots de passe & authentification\n    debutant:   \"Bases faibles : bo√Æte de r√©ception, email pro/perso, objet clair, destinataires.\",\n    en_progres: \"Bon niveau mais erreurs : objet pr√©cis, v√©rifie destinataires, contexte formel.\",\n    competent:  \"Cl√©s 2FA/TOTP, r√©vocation acc√®s, codes de secours.\",\n    expert:     \"Ma√Ætrise email : objets, adresses, r√©ponses collectives. Explore signatures et filtres.\",\n  },\n  \"3:3\": { // Vie priv√©e & conformit√©\n    debutant:   \"Bases √† acqu√©rir : partage cloud, messagerie instantan√©e, public/priv√© r√©seaux.\",\n    en_progres: \"Bases pr√©sentes mais confusions : pratique partage contr√¥l√©, messages adapt√©s.\",\n    competent:  \"Export/suppression donn√©es, chiffrement, mots de passe pour archives.\",\n    expert:     \"√Ä l‚Äôaise : partage, messageries, confidentialit√© r√©seaux. Bonne ma√Ætrise.\",\n  },\n\n  // Session 4\n  \"4:1\": { // Services & usages en ligne\n    debutant:   \"Fragile : docs collaboratifs, calendrier partag√©, visioconf.\",\n    en_progres: \"Comprend outils, mais pratique : cr√©e doc, planifie √©v√©nement, rejoins visioconf.\",\n    competent:  \"Paiements, plafonds/alertes, dossiers en ligne complets.\",\n    expert:     \"√Ä l‚Äôaise : partage docs, r√©unions, calendriers. Efficace √† distance.\",\n  },\n  \"4:2\": { // Information & actualit√©\n    debutant:   \"Bases manquantes : site s√©curis√©, fake news, services publics en ligne.\",\n    en_progres: \"Pratiques utiles mais √† renforcer : https, croise sources, d√©marches admin.\",\n    competent:  \"Analyse biais/financements, suit sources fiables.\",\n    expert:     \"R√©flexes solides : achats s√©curis√©s, esprit critique, autonomie admin. Bravo.\",\n  },\n  \"4:3\": { // Programmation & IA\n    debutant:   \"Fragile : cookies, v√©rif infos, suivre actualit√© num√©rique.\",\n    en_progres: \"Bonne intuition mais zones d‚Äôombre : cookies, sources, suivre IA.\",\n    competent:  \"Projets structur√©s, Git, algos clairs, IA prototypage.\",\n    expert:     \"Bonne compr√©hension : donn√©es, v√©rif infos, actu num√©rique/IA. Bravo.\",\n  },\n};\n\n// ================= Donn√©es d‚Äôentr√©e =================\nconst a = $input.all()[0].json;\n\n// Index par question: \"q1\"..\"q40\" -> {score,max}\nconst qIndex = new Map();\nfor (const d of (a.details || [])) {\n  qIndex.set(d.key, {\n    score: Number(d.score ?? 0),\n    max:   Number(d.max ?? d.max_score ?? 0),\n  });\n}\n\n// D√©coupage explicite (corrig√© S2)\nconst EXPLICIT_MAP = {\n  \"1\": { \"1\": [\"q1\",\"q2\",\"q4\"], \"2\": [\"q5\",\"q6\",\"q8\"], \"3\": [\"q3\",\"q7\",\"q9\",\"q10\"] },\n  \"2\": { \"1\": [\"q11\",\"q12\",\"q13\",\"q14\",\"q16\"], \"2\": [\"q15\",\"q17\",\"q18\"], \"3\": [\"q19\",\"q20\"] },\n  \"3\": { \"1\": [\"q21\",\"q22\",\"q23\",\"q26\"], \"2\": [\"q24\",\"q25\",\"q27\"], \"3\": [\"q28\",\"q29\",\"q30\"] },\n  \"4\": { \"1\": [\"q31\",\"q35\",\"q40\"], \"2\": [\"q32\",\"q33\",\"q34\",\"q36\"], \"3\": [\"q37\",\"q38\",\"q39\"] },\n};\n\n// Libell√©s (optionnels)\nconst LABELS = {\n  \"1\": [\"Navigation & Internet\",\"Logiciels & S√©curit√©\",\"Gestion des fichiers & Organisation\"],\n  \"2\": [\"Emails & messagerie\",\"Cloud & outils collaboratifs\",\"R√©seaux sociaux & visioconf√©rence\"],\n  \"3\": [\"Protection contre les menaces\",\"Mots de passe & authentification\",\"Vie priv√©e & conformit√©\"],\n  \"4\": [\"Services & usages en ligne\",\"Information & actualit√© num√©rique\",\"Programmation & intelligence artificielle\"],\n};\n\n// Utils\nconst sumQ = (keys) => {\n  let s = 0, m = 0;\n  for (const k of keys) {\n    const qm = qIndex.get(k) || { score:0, max:0 };\n    s += qm.score; m += qm.max;\n  }\n  return { score: s, max: m, pct: pct(s, m) };\n};\n\nconst subthemeBilan = (sId, pId, p) => {\n  const lk = levelKey(p);\n  const entry = BILANS[`${sId}:${pId}`];\n  return (entry && entry[lk]) ? entry[lk] : genericBilan(p);\n};\n\n// ================= Construction du rapport =================\nconst report = {\n  horodateur: a.horodateur,\n  email: a[\"email\"] || \"\", \n  global: {\n    score: a.total_score,\n    max:   a.total_max,\n    pct:   a.percent,\n    level: a.level || levelFromPct(a.percent),\n    stars: stars(a.percent),\n    bilan: genericBilan(a.percent),\n  },\n  sessions: [],\n};\n\n// Sessions 1..4\nfor (const sId of [\"1\",\"2\",\"3\",\"4\"]) {\n  const mapSess = EXPLICIT_MAP[sId];\n  if (!mapSess) continue;\n\n  const allQs = Array.from(new Set([...(mapSess[\"1\"]||[]), ...(mapSess[\"2\"]||[]), ...(mapSess[\"3\"]||[]) ]));\n  const total = sumQ(allQs);\n\n  const labels = LABELS[sId] || [\"Partie 1\",\"Partie 2\",\"Partie 3\"];\n  const parts = [\"1\",\"2\",\"3\"].map((pid, idx) => {\n    const qs = mapSess[pid] || [];\n    const r  = sumQ(qs);\n    const lvl = levelFromPct(r.pct);\n    return {\n      id: pid,\n      label: labels[idx],\n      questions: qs,\n      score: r.score,\n      max:   r.max,\n      pct:   r.pct,\n      level: lvl,\n      stars: stars(r.pct),\n      bilan: subthemeBilan(sId, pid, r.pct), // üëà sp√©cifique sous-th√®me + niveau\n    };\n  });\n\n  report.sessions.push({\n    id: sId,\n    label: `Session ${sId}`,\n    total_score: total.score,\n    total_max:   total.max,\n    total_pct:   total.pct,\n    level:       levelFromPct(total.pct),\n    stars:       stars(total.pct),\n    bilan:       genericBilan(total.pct), // tu peux aussi faire un bilan agr√©g√© si besoin\n    subthemes:   parts,\n  });\n}\n\nreturn [{ json: report }];\n\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        176,
        -32
      ],
      "id": "34a65495-9e1f-4091-bd66-20004950a058",
      "name": "Build_report"
    },
    {
      "parameters": {
        "jsCode": "// Entr√©e = liste de lignes avec row_number, cl√©, somme, n, moyenne\nconst rows = $input.all().map(item => item.json);\n\n// Helper pour formater %\nfunction pctFmt(n) {\n  return `${Number(n || 0).toFixed(0)}%`;\n}\n\nconst placeholders = {};\n\nfor (const r of rows) {\n  if (r.cl√© && r.moyenne !== undefined) {\n    // Exemple : cl√© = \"S1_SUB1_AVG\"\n    placeholders[r.cl√©] = pctFmt(r.moyenne);\n  }\n}\n\nreturn [{\n  json: {\n    placeholders\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        432,
        -208
      ],
      "id": "860d8e49-0307-48bf-a9ae-fd7d3f2abfef",
      "name": "Average Placeholders"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"rules\": {\n    \"split\": \", \",\n    \"thresholds\": { \"beginner\": 40, \"intermediate\": 70 },\n    \"questions\": [\n      {\n        \"key\": \"q1\",\n        \"label_snippet\": \"naviguer sur internet\",\n        \"theme\": \"bases_web\",\n        \"scoring_mode\": \"max\",\n        \"options\": {\n          \"Utiliser un navigateur (Chrome; Firefox; Edge‚Ä¶) pour visiter des sites\":1,\n          \"Cliquer sur des liens pour passer d‚Äôune page √† l‚Äôautre\": 1,\n          \"Lire un livre de programmation\": 0,\n          \"Installer un antivirus\": 0\n        }\n      },\n      {\n        \"key\": \"q2\",\n        \"label_snippet\": \"barre de recherche\",\n        \"theme\": \"bases_web\",\n        \"scoring_mode\": \"max\",\n        \"options\": {\n          \"Trouver des informations sur Internet\": 1,\n          \"Envoyer un SMS\": 0,\n          \"√âcrire l‚Äôadresse d‚Äôun site web (URL)\": 1,\n          \"Installer des programmes\": 0\n        }\n      },\n      {\n        \"key\": \"q3\",\n        \"label_snippet\": \"ordinateur de bureau et un smartphone\",\n        \"theme\": \"bases_web\",\n        \"scoring_mode\": \"max\",\n        \"options\": {\n          \"L‚Äôordinateur est fixe; le smartphone est portable\": 1,\n          \"Les deux ont exactement les m√™mes usages\": 0,\n          \"L‚Äôordinateur est souvent plus puissant\": 1,\n          \"L‚Äôordinateur ne peut pas √™tre connect√© au Wi-Fi\": 0,\n          \"Les deux peuvent utiliser des applications\": 1    \n        }\n       }, \n       {\n         \"key\": \"q4\",\n         \"label_snippet\": \"une adresse email et une adresse web\",\n         \"theme\": \"bases_web\",\n         \"scoring_mode\": \"max\",\n         \"options\": {\n           \"L‚Äôadresse email sert √† envoyer/recevoir des messages\": 1,\n           \"L‚Äôadresse web permet d‚Äôacc√©der √† un site Internet\": 1,\n           \"Les deux sont identiques\": 0,\n           \"Une adresse email contient souvent ‚Äú@‚Äù\": 1,\n           \"Une adresse web commence souvent par ‚Äúhttp://‚Äù ou ‚Äúhttps://‚Äù\": 1,\n           \"Une adresse email est obligatoire pour se connecter √† Internet\": 0,\n           \"Une adresse web sert uniquement √† envoyer des fichiers\": 0\n        }\n      },\n      {\n        \"key\": \"q5\",\n        \"label_snippet\": \"‚Äúmettre √† jour‚Äù\",\n        \"theme\": \"bases_web\",\n        \"scoring_mode\": \"max\",\n        \"options\": {\n          \"Installer la derni√®re version du logiciel\": 1,\n          \"Ajouter de nouvelles fonctionnalit√©s\": 1,\n          \"Corriger des failles de s√©curit√©\": 1,\n          \"Effacer toutes ses donn√©es\": 0,\n          \"Changer de mot de passe\": 0,\n          \"Supprimer le logiciel\": 0\n        }\n      },\n      {\n        \"key\": \"q6\",\n        \"label_snippet\": \"‚Äúcopier-coller‚Äù\",\n        \"theme\": \"bases_web\",\n        \"scoring_mode\": \"max\",\n        \"options\": {\n          \"Dupliquer un texte ou un fichier d‚Äôun endroit vers un autre\": 1,\n          \"Utiliser les touches Ctrl+C puis Ctrl+V\": 1,\n          \"T√©l√©charger un logiciel sp√©cial pour copier-coller\": 0,\n          \"Lire un texte √† haute voix puis l‚Äô√©crire √† nouveau\": 0\n        }\n      },\n      {\n        \"key\": \"q7\",\n        \"label_snippet\": \"reconna√Ætre si un fichier\",\n        \"theme\": \"bases_informatique\",\n        \"scoring_mode\": \"max\",\n        \"options\": {\n          \"En regardant son extension (.jpg; .docx; .mp4)\": 1,\n          \"En ouvrant le fichier dans le logiciel adapt√©\": 1,\n          \"Gr√¢ce √† l‚Äôic√¥ne du fichier (image; texte; vid√©o)\": 0.5,\n          \"En demandant au voisin\": 0,\n          \"Tous les fichiers sont identiques\": 0\n      }\n     },\n     {\n       \"key\": \"q8\",\n       \"label_snippet\": \"ouvrir une pi√®ce jointe\",\n       \"theme\": \"bases_informatique\",\n       \"scoring_mode\": \"max\",\n       \"options\": {\n         \"Cliquer sur l‚Äôic√¥ne ou le lien de la pi√®ce jointe\": 1,\n         \"Ouvrir le message et choisir ‚ÄúT√©l√©charger‚Äù\": 1,\n         \"Attendre qu‚Äôelle s‚Äôouvre toute seule\": 0,\n         \"V√©rifier l‚Äôextension du fichier avant d‚Äôouvrir (s√©curit√©)\": 0.5,\n         \"Lire uniquement l‚Äôobjet du mail\": 0\n      }\n     },\n     {\n       \"key\": \"q9\",\n       \"label_snippet\": \"nouveau dossier\",\n       \"theme\": \"bases_informatique\",\n       \"scoring_mode\": \"max\",\n       \"options\": {\n         \"Cliquer droit > Nouveau > Dossier\": 1,\n         \"Aller dans ‚ÄúFichier > Nouveau dossier‚Äù\": 1,\n         \"Appuyer sur la touche ‚ÄúSuppr‚Äù\": 0,\n         \"Utiliser le raccourci clavier (par ex. Ctrl+Maj+N\": 1,\n         \"T√©l√©charger un logiciel sp√©cial pour cr√©er des dossiers\": 0,\n         \"Aller sur Internet pour cr√©er un dossier\": 0\n      }\n     },\n     {\n       \"key\": \"q10\",\n       \"label_snippet\": \"enregistrer un fichier\",\n       \"theme\": \"bases_informatique\",\n       \"scoring_mode\": \"max\",\n       \"options\": {\n         \"Cliquer sur ‚ÄúFichier > Enregistrer sous‚Äù\": 1,\n         \"Copier le fichier sur une cl√© USB\": 0.5,\n         \"Prendre une photo de l‚Äô√©cran\": 0,\n         \"Laisser le fichier ouvert et ne pas l‚Äôenregistrer\": 0,\n         \"Enregistrer dans un dossier choisi (ex. Documents; Bureau)\": 1,\n         \"Demander √† un ami de le sauvegarder\": 0\n         \n      }\n     },\n     {\n       \"key\": \"q11\",\n       \"label_snippet\": \"bo√Æte de r√©ception email\",\n       \"theme\": \"bases_informatique\",\n       \"scoring_mode\": \"max\",\n       \"options\": {\n         \"L‚Äôendroit o√π arrivent les nouveaux messages\": 1,\n         \"Une application pour √©crire du code\": 0,\n         \"Un espace o√π l‚Äôon peut lire; r√©pondre et g√©rer ses mails\": 1,\n         \"Un r√©pertoire de contacts\": 0,\n         \"Un logiciel qui bloque les virus\": 0\n     }\n    },\n    {\n    \"key\": \"q12\",\n    \"label_snippet\": \"email professionnel\",\n    \"theme\": \"bases_informatique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"L‚Äôadresse contient souvent le nom de l‚Äôentreprise\": 1,\n      \"Le ton est plus formel\": 1,\n      \"Les signatures automatiques avec coordonn√©es sont fr√©quentes\": 1,\n      \"Les emails professionnels n‚Äôont jamais de fautes\": 0,\n      \"L‚Äôadresse personnelle utilise souvent @gmail.com; @yahoo.com‚Ä¶\": 1,\n      \"L‚Äôemail professionnel contient souvent un logo\": 0.5,\n      \"Les emails personnels ne peuvent pas avoir de pi√®ces jointes\": 0\n    }\n  },\n  {\n    \"key\": \"q13\",\n    \"label_snippet\": \"objet clair dans un email\",\n    \"theme\": \"bases_informatique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Pour indiquer rapidement le sujet du message\": 1,\n      \"Pour faciliter la recherche ult√©rieure\": 1,\n      \"Parce que la loi l‚Äôexige\": 0,\n      \"Pour √©viter que le mail soit consid√©r√© comme spam\": 0.5,\n      \"Parce que les emails sans objet ne peuvent pas √™tre envoy√©s\": 0,\n      \"Pour attirer l‚Äôattention du destinataire\": 0.5,\n      \"Pour remplacer le contenu du message\": 0\n    }\n  },\n  {\n    \"key\": \"q14\",\n    \"label_snippet\": \"‚Äúr√©pondre √† tous‚Äù dans un email\",\n    \"theme\": \"bases_informatique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"R√©pondre √† l‚Äôexp√©diteur et √† toutes les personnes en copie\": 1,\n      \"Cr√©er un nouveau mail vide\": 0,\n      \"R√©pondre publiquement sur Internet\": 0,\n      \"R√©pondre en incluant les pi√®ces jointes\": 0.5,\n      \"R√©pondre avec un accus√© de r√©ception\": 0\n    }\n  },\n  {\n    \"key\": \"q15\",\n    \"label_snippet\": \"partager un document‚Äù dans le cloud\",\n    \"theme\": \"bases_informatique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Rendre le fichier accessible √† d‚Äôautres personnes\": 1,\n      \"D√©poser un fichier sur son bureau\": 0,\n      \"Donner un lien avec droits de lecture ou d‚Äô√©dition\": 1,\n      \"Imprimer le document et le donner √† un coll√®gue\": 0,\n      \"Le rendre public sur Internet sans contr√¥le\": 0\n    }\n  },\n  {\n    \"key\": \"q16\",\n    \"label_snippet\": \"messagerie instantan√©e\",\n    \"theme\": \"bases_informatique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Un service pour √©changer des messages en temps r√©el\": 1,\n      \"Une bo√Æte email traditionnelle\": 0,\n      \"Un outil pour envoyer des photos; vid√©os; emojis\": 0.5,\n      \"Un service accessible sur ordinateur et smartphone\": 1,\n      \"Un r√©seau social public uniquement\": 0,\n      \"Une messagerie qui ne fonctionne qu‚Äôen entreprise\": 0\n    }\n  },\n  {\n    \"key\": \"q17\",\n    \"label_snippet\": \"message public\",\n    \"theme\": \"bases_informatique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Le message public est visible par tout le monde\": 1,\n      \"Le message priv√© est visible uniquement par la personne cibl√©e\": 1,\n      \"Les deux sont visibles par les amis uniquement\": 0,\n      \"Un message public peut √™tre partag√©\": 1,\n      \"Un message priv√© peut √™tre lu par tout le r√©seau\": 0,\n      \"Un message priv√© s‚Äôappelle aussi ‚ÄúDM‚Äù\": 1\n    }\n  },\n  {\n    \"key\": \"q18\",\n    \"label_snippet\": \"‚Äúoutil collaboratif‚Äù\",\n    \"theme\": \"bases_informatique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Un logiciel permettant de travailler √† plusieurs sur le m√™me document\": 1,\n      \"Une plateforme de jeux en ligne\": 0,\n      \"Un espace pour stocker des fichiers et y acc√©der ensemble\": 0.5,\n      \"Une application qui sert uniquement aux d√©veloppeurs\": 0,\n      \"Un outil de visioconf√©rence int√©gr√©\": 0.5\n    }\n  },\n  {\n    \"key\": \"q19\",\n    \"label_snippet\": \"calendrier en ligne partag√©\",\n    \"theme\": \"bases_informatique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Un outil o√π plusieurs personnes peuvent consulter/ajouter des √©v√©nements\": 1,\n      \"Un logiciel de traitement de texte\": 0,\n      \"Une fonction dans Google Calendar ou Outlook\": 1,\n      \"Un calendrier que tout le monde peut modifier\": 0.5,\n      \"Un site web de m√©t√©o\": 0\n    }\n  },\n  {\n    \"key\": \"q20\",\n    \"label_snippet\": \"organiser une visioconf√©rence\",\n    \"theme\": \"bases_informatique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Envoyer un lien d‚Äôinvitation par email\": 1,\n      \"Utiliser un outil comme Zoom; Teams ou Meet\": 1,\n      \"Se r√©unir uniquement en pr√©sentiel\": 0,\n      \"Activer la cam√©ra et le micro\": 0.5,\n      \"Utiliser uniquement les SMS\": 0,\n      \"Programmer la r√©union dans un calendrier partag√©\": 1\n    }\n    },\n    {\n    \"key\": \"q21\",\n    \"label_snippet\": \"antivirus\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Un programme qui prot√®ge contre les logiciels malveillants\": 1,\n      \"Un logiciel qui acc√©l√®re Internet\": 0,\n      \"Un outil qui bloque les virus informatiques\": 1,\n      \"Une extension obligatoire pour tous les navigateurs\": 0,\n      \"Une application qui v√©rifie les fichiers avant ouverture\": 0.5,\n      \"Un logiciel qui installe des mises √† jour Windows\": 0\n    }\n  },\n  {\n    \"key\": \"q22\",\n    \"label_snippet\": \"lien dangereux\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Fermer imm√©diatement la page\": 1,\n      \"Red√©marrer l‚Äôordinateur sans rien faire\": 0,\n      \"Lancer une analyse antivirus\": 1,\n      \"Supprimer le navigateur\": 0,\n      \"Changer ses mots de passe si n√©cessaire\": 1,\n      \"Ignorer le probl√®me\": 0\n    }\n  },\n  {\n    \"key\": \"q23\",\n    \"label_snippet\": \"email frauduleux (phishing)\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Il demande des informations personnelles ou bancaires\": 1,\n      \"Il contient souvent des fautes d‚Äôorthographe\": 1,\n      \"L‚Äôadresse de l‚Äôexp√©diteur semble suspecte\": 1,\n      \"Il vient toujours de son propre patron\": 0,\n      \"Le lien affich√© ne correspond pas au vrai site\": 1,\n      \"Il contient forc√©ment une pi√®ce jointe\": 0\n    }\n  },\n  {\n    \"key\": \"q24\",\n    \"label_snippet\": \"mot de passe partout\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Parce que √ßa rend tous les comptes vuln√©rables en cas de piratage\": 1,\n      \"Parce que c‚Äôest plus difficile √† retenir\": 0,\n      \"Parce que certains sites l‚Äôinterdisent\": 0,\n      \"Parce que √ßa √©vite d‚Äô√™tre bloqu√© si un mot de passe est vol√©\": 1,\n      \"Parce que √ßa emp√™che d‚Äôouvrir ses emails\": 0\n    }\n  },\n  {\n    \"key\": \"q25\",\n    \"label_snippet\": \"verrouiller son ordinateur\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Pour √©viter l‚Äôacc√®s non autoris√©\": 1,\n      \"Pour √©conomiser de la batterie\": 0,\n      \"Pour prot√©ger les donn√©es personnelles\": 1,\n      \"Parce que c‚Äôest obligatoire par la loi\": 0,\n      \"Pour emp√™cher quelqu‚Äôun d‚Äôenvoyer des messages √† sa place\": 1,\n      \"Pour acc√©l√©rer l‚Äôappareil\": 0\n    }\n  },\n  {\n    \"key\": \"q26\",\n    \"label_snippet\": \"SMS suspect\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Ne pas r√©pondre\": 1,\n      \"Supprimer imm√©diatement le message\": 1,\n      \"Cliquer sur le lien pour v√©rifier\": 0,\n      \"Transf√©rer le message √† l‚Äôautorit√© comp√©tente (ex : 33700)\": 1,\n      \"Donner de fausses informations pour pi√©ger l‚Äôarnaqueur\": 0,\n      \"Pr√©venir sa banque\": 1\n    }\n  },\n  {\n    \"key\": \"q27\",\n    \"label_snippet\": \"authentification\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Se connecter avec un mot de passe et un code re√ßu par SMS\": 1,\n      \"Utiliser uniquement une carte bancaire\": 0,\n      \"Avoir deux comptes au lieu d‚Äôun\": 0,\n      \"V√©rifier son identit√© avec deux m√©thodes diff√©rentes\": 1,\n      \"Changer de mot de passe tous les jours\": 0,\n      \"Utiliser une application d‚Äôauthentification (Google Authenticator; etc.)\": 1\n    }\n  },\n  {\n    \"key\": \"q28\",\n    \"label_snippet\": \"protection des donn√©es\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Respecter la confidentialit√© des informations priv√©es\": 1,\n      \"Partager ses informations avec tout le monde\": 0,\n      \"Contr√¥ler qui a acc√®s √† ses donn√©es\": 1,\n      \"Prot√©ger ses fichiers contre le vol\": 1,\n      \"Supprimer tous ses comptes Internet\": 0,\n      \"Respecter des lois comme le RGPD\": 1\n    }\n  },\n  {\n    \"key\": \"q29\",\n    \"label_snippet\": \"applications\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Pour corriger les failles de s√©curit√©\": 1,\n      \"Pour ajouter de nouvelles fonctionnalit√©s\": 1,\n      \"Parce que l‚Äôordinateur ne fonctionne pas sinon\": 0,\n      \"Pour am√©liorer la stabilit√© du logiciel\": 1,\n      \"Pour consommer plus de batterie\": 0,\n      \"Parce que c‚Äôest gratuit\": 0\n    }\n  },\n  {\n    \"key\": \"q30\",\n    \"label_snippet\": \"connexion s√©curis√©e (HTTPS)\",\n    \"theme\": \"cybersecurite\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Les donn√©es √©chang√©es sont chiffr√©es\": 1,\n      \"Le site est forc√©ment officiel\": 0,\n      \"Le cadenas appara√Æt dans la barre d‚Äôadresse\": 1,\n      \"La connexion est plus rapide\": 0,\n      \"Le site ne peut jamais √™tre pirat√©\": 0,\n      \"L‚Äôadresse commence par ‚Äúhttps://‚Äù\": 1\n    }\n    },\n  {\n    \"key\": \"q31\",\n    \"label_snippet\": \"achat en ligne\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Un achat effectu√© sur un site HTTPS\": 1,\n      \"Un achat o√π l‚Äôon paie toujours en liquide\": 0,\n      \"Un paiement avec authentification (code SMS; 3D Secure)\": 1,\n      \"Un achat fait uniquement aux heures de bureau\": 0,\n      \"V√©rifier la r√©putation du site avant d‚Äôacheter\": 1,\n      \"Utiliser un ordinateur public pour payer\": 0\n    }\n  },\n  {\n    \"key\": \"q32\",\n    \"label_snippet\": \"‚Äúcookie‚Äù sur un site web\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Un petit fichier enregistr√© sur l‚Äôordinateur\": 1,\n      \"Un biscuit qu‚Äôon mange devant l‚Äô√©cran\": 0,\n      \"Un outil qui garde des informations de navigation\": 1,\n      \"Un virus informatique\": 0,\n      \"Un moyen de personnaliser la publicit√©\": 1,\n      \"Un mot de passe secret\": 0\n    }\n  },\n  {\n    \"key\": \"q33\",\n    \"label_snippet\": \"reconna√Ætre une fake news\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Le titre est sensationnaliste\": 1,\n      \"La source n‚Äôest pas fiable ou absente\": 1,\n      \"L‚Äôarticle est v√©rifi√© par plusieurs m√©dias\": 0,\n      \"Il contient souvent des erreurs ou contradictions\": 1,\n      \"Il est partag√© massivement par des comptes suspects\": 1,\n      \"Les commentaires disent tous que c‚Äôest vrai\": 0\n    }\n  },\n  {\n    \"key\": \"q34\",\n    \"label_snippet\": \"fiabilit√© d‚Äôune information\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"V√©rifier la source et l‚Äôauteur\": 1,\n      \"Lire uniquement le titre\": 0,\n      \"Croiser l‚Äôinformation avec plusieurs sites\": 1,\n      \"Croire tout ce qui circule sur les r√©seaux sociaux\": 0,\n      \"V√©rifier la date de publication\": 1,\n      \"Partager sans v√©rifier pour demander l‚Äôavis des amis\": 0\n    }\n  },\n  {\n    \"key\": \"q35\",\n    \"label_snippet\": \"application bancaire en ligne\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Consulter le solde et les mouvements\": 1,\n      \"Faire des virements\": 1,\n      \"Jouer √† des jeux gratuits\": 0,\n      \"Contacter directement son conseiller bancaire\": 1,\n      \"Retirer de l‚Äôargent liquide\": 0,\n      \"Payer en ligne avec validation s√©curis√©e\": 1\n    }\n  },\n  {\n    \"key\": \"q36\",\n    \"label_snippet\": \"suivre l‚Äôactualit√© num√©rique\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Pour rester inform√© des √©volutions du monde digital\": 1,\n      \"Pour mieux se prot√©ger contre les nouvelles menaces\": 1,\n      \"Parce que c‚Äôest obligatoire √† l‚Äô√©cole\": 0,\n      \"Pour d√©couvrir de nouveaux outils utiles\": 1,\n      \"Pour pouvoir travailler dans tous les m√©tiers du futur\": 0.5,\n      \"Pour comprendre les tendances qui impactent la vie quotidienne\": 1\n    }\n  },\n  {\n    \"key\": \"q37\",\n    \"label_snippet\": \"langage de programmation\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Un ensemble d‚Äôinstructions pour donner des ordres √† un ordinateur\": 1,\n      \"Une langue √©trang√®re comme l‚Äôanglais\": 0,\n      \"Un outil pour cr√©er des applications ou sites web\": 1,\n      \"Un dictionnaire num√©rique\": 0,\n      \"Des langages comme Python; Java ou C++\": 1,\n      \"Une mani√®re de discuter entre deux ordinateurs via SMS\": 0\n    }\n  },\n  {\n    \"key\": \"q38\",\n    \"label_snippet\": \"algorithme\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Une suite d‚Äôinstructions permettant de r√©soudre un probl√®me\": 1,\n      \"Un virus informatique\": 0,\n      \"Un langage de programmation complet\": 0,\n      \"Un ensemble de r√®gles utilis√©es par les moteurs de recherche\": 1,\n      \"Un robot physique\": 0.5,\n      \"Une recette de cuisine; par analogie\": 1\n    }\n  },\n  {\n    \"key\": \"q39\",\n    \"label_snippet\": \"intelligence artificielle\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Un syst√®me capable de simuler certaines fonctions humaines (ex : reconna√Ætre une image)\": 1,\n      \"Un humain qui pense tr√®s vite\": 0,\n      \"Un programme qui apprend √† partir de donn√©es\": 1,\n      \"Une machine qui ne peut jamais se tromper\": 0,\n      \"Des applications comme la reconnaissance vocale ou les chatbots\": 1,\n      \"Un ordinateur utilis√© uniquement dans les films\": 0\n    }\n  },\n{ \n    \"key\": \"q40\",\n    \"label_snippet\": \"‚Äúe-administration‚Äù\",\n    \"theme\": \"culture_numerique\",\n    \"scoring_mode\": \"max\",\n    \"options\": {\n      \"Acc√©der aux services publics en ligne (imp√¥ts; CAF; etc.)\": 1,\n      \"G√©rer une administration dans un jeu vid√©o\": 0,\n      \"D√©poser ses d√©clarations sans se d√©placer\": 1,\n      \"Obtenir un rendez-vous √† la mairie par t√©l√©phone\": 0,\n      \"T√©l√©charger des formulaires officiels\": 1,\n      \"Envoyer un courrier postal au centre administratif\": 0\n    }\n\n      }\n    ]\n  }\n}\n",
        "includeOtherFields": "={{ true }}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -304,
        -32
      ],
      "id": "e009f338-d037-4dae-8d4b-090ba9ee3de9",
      "name": "Scoring System"
    },
    {
      "parameters": {
        "jsCode": "// --- Helpers ---\nconst norm = (s) => String(s ?? \"\")\n  .normalize(\"NFD\")\n  .replace(/\\p{Diacritic}/gu, \"\")\n  .replace(/[‚Äú‚Äù¬´¬ª\"']/g, \"\")\n  .replace(/\\s+/g, \" \")\n  .trim()\n  .toLowerCase();\n\nconst input = items[0].json; // ‚ö†Ô∏è Run Once for All Items\nconst rules = input.rules;\nif (!rules) {\n  return [{ json: { error: \"Aucune r√®gle trouv√©e dans input.rules\" } }];\n}\n\nconst thresholds = rules.thresholds || { beginner: 40, intermediate: 70 };\nconst questions = rules.questions || [];\nconst horodateur = input[\"Horodateur\"] || null;\nconst email = input[\"Adresse e-mail\"] || \"\";   // üëà r√©cup√®re l‚Äôemail\n\nfunction findAnswers(label) {\n  const needle = norm(label);\n  for (const k of Object.keys(input)) {\n    if (k.endsWith(\"__arr\") && norm(k.replace(\"__arr\", \"\")).includes(needle)) {\n      return input[k];\n    }\n  }\n  console.log(\"üîé No match for:\", needle, \"in keys:\", Object.keys(input));\n  return [];\n}\n\n// --- INIT blocs ---\nconst blocs = {\n  q01_q10: { score: 0, max: 0 },\n  q11_q20: { score: 0, max: 0 },\n  q21_q30: { score: 0, max: 0 },\n  q31_q40: { score: 0, max: 0 },\n};\n\nconst details = [];\nlet totalScore = 0;\nlet totalMax = 0;\n\nfor (const q of questions) {\n  const options = q.options || {};\n  const answers = findAnswers(q.label_snippet || q.key);\n  const answersNorm = new Set(answers.map(norm));\n\n  const maxForQ = Object.values(options)\n    .map(v => Number(v) || 0)\n    .filter(v => v > 0)\n    .reduce((a, b) => a + b, 0);\n\n  let scoreForQ = 0;\n  for (const [rawLabel, val] of Object.entries(options)) {\n    const label = norm(rawLabel);\n    if (answersNorm.has(label)) {\n      scoreForQ += Number(val) || 0;\n    }\n  }\n\n  if (scoreForQ > maxForQ) scoreForQ = maxForQ;\n\n  totalScore += scoreForQ;\n  totalMax += maxForQ;\n\n  // Bloc ?\n  const qNum = Number(q.key.replace(\"q\", \"\"));\n  let bloc = null;\n  if (qNum >= 1 && qNum <= 10) bloc = \"q01_q10\";\n  else if (qNum >= 11 && qNum <= 20) bloc = \"q11_q20\";\n  else if (qNum >= 21 && qNum <= 30) bloc = \"q21_q30\";\n  else if (qNum >= 31 && qNum <= 40) bloc = \"q31_q40\";\n\n  if (bloc) {\n    blocs[bloc].score += scoreForQ;\n    blocs[bloc].max += maxForQ;\n  }\n\n  details.push({\n    key: q.key,\n    label: q.label_snippet,\n    theme: q.theme || null,\n    answers,\n    score: scoreForQ,\n    max: maxForQ\n  });\n}\n\n// --- Calculs finaux ---\nconst percent = totalMax > 0 ? Math.round((totalScore / totalMax) * 100) : 0;\nlet level = \"advanced\";\nif (percent < thresholds.beginner) level = \"beginner\";\nelse if (percent < thresholds.intermediate) level = \"intermediate\";\n\nfunction blocInfo(b) {\n  const bloc = blocs[b];\n  return {\n    score: bloc.score,\n    max: bloc.max,\n    percent: bloc.max > 0 ? Math.round((100 * bloc.score) / bloc.max) : 0\n  };\n}\n\n// --- Sortie ---\nreturn [{\n  json: {\n    horodateur,\n    email,  // üëà adresse e-mail pass√©e de l‚Äôinput √† l‚Äôoutput\n    total_score: totalScore,\n    total_max: totalMax,\n    percent,\n    level,\n    blocks: {\n      q01_q10: blocInfo(\"q01_q10\"),\n      q11_q20: blocInfo(\"q11_q20\"),\n      q21_q30: blocInfo(\"q21_q30\"),\n      q31_q40: blocInfo(\"q31_q40\"),\n    },\n    details\n  }\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -112,
        -32
      ],
      "id": "10cb08fb-49bb-443e-9141-ae10a5b044ae",
      "name": "AnalyseS"
    },
    {
      "parameters": {
        "jsCode": "// --- 1) Ne garder que la derni√®re ligne selon \"Horodateur\" (format FR) ---\nfunction parseFRDatetime(s) {\n  if (!s) return 0;\n  const m = String(s).match(/(\\d{2})\\/(\\d{2})\\/(\\d{4})\\s+(\\d{2}):(\\d{2}):(\\d{2})/);\n  if (!m) return 0;\n  const [ , dd, MM, yyyy, HH, mm, ss ] = m.map(Number);\n  return new Date(yyyy, MM - 1, dd, HH, mm, ss).getTime();\n}\n\nconst all = $items();\nif (!all.length) return [];\n\n// Trie les lignes par date croissante\nall.sort((a, b) => parseFRDatetime(a.json.Horodateur) - parseFRDatetime(b.json.Horodateur));\nconst last = all[all.length - 1].json;\n\n// --- 2) Extraire uniquement les champs utiles ---\nconst SEP = \", \";\nconst out = {\n  Horodateur: last[\"Horodateur\"],\n  \"Adresse e-mail\": last[\"Adresse e-mail\"] || \"\"   // üëà ajout de l'adresse e-mail\n};\n\nfor (const [key, val] of Object.entries(last)) {\n  if (key === \"Horodateur\" || key === \"Adresse e-mail\") continue; // üëà on ne les retrait pas\n\n  if (typeof val === \"string\" && val.includes(SEP)) {\n    out[`${key}__arr`] = val.split(SEP).map(s => s.trim()).filter(Boolean);\n  }\n}\n\nreturn [{ json: out }];\n\n\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -576,
        -32
      ],
      "id": "1520bc1d-0ce5-45bb-8b9b-1a02ada05e4b",
      "name": "Last Questionnaire Retrieval"
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "1-fUTmwyK6b1H-AvH12BvyPwBpB-u2tau_FwIyZQxEBc",
          "mode": "list",
          "cachedResultName": "Mod√®le bilans questionnaires",
          "cachedResultUrl": "https://docs.google.com/presentation/d/1-fUTmwyK6b1H-AvH12BvyPwBpB-u2tau_FwIyZQxEBc/edit?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        944,
        64
      ],
      "id": "9baa8706-47ff-4bbd-87b0-bee65c16a6f1",
      "name": "Copy File Slide Model",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "HXU4UVHEKoqRGjM7",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        752,
        -192
      ],
      "id": "76263eec-3abe-4a93-86bc-4345209826ba",
      "name": "Merge Placeholders"
    }
  ],
  "pinData": {},
  "connections": {
    "Google Sheets Trigger": {
      "main": [
        [
          {
            "node": "Last Questionnaire Retrieval",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Graph URL create": {
      "main": [
        [
          {
            "node": "Copy File Slide Model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request Get Slides": {
      "main": [
        [
          {
            "node": "Extract images from slides",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "placeholders": {
      "main": [
        [
          {
            "node": "Merge Placeholders",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Average Placeholders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Http Request Post Slides": {
      "main": [
        [
          {
            "node": "HTTP Request Transform PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract images from slides": {
      "main": [
        [
          {
            "node": "Http Request Post Slides",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request Transform PDF": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build_report": {
      "main": [
        [
          {
            "node": "placeholders",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Average Placeholders": {
      "main": [
        [
          {
            "node": "Merge Placeholders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Scoring System": {
      "main": [
        [
          {
            "node": "AnalyseS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AnalyseS": {
      "main": [
        [
          {
            "node": "Build_report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Last Questionnaire Retrieval": {
      "main": [
        [
          {
            "node": "Scoring System",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Copy File Slide Model": {
      "main": [
        [
          {
            "node": "HTTP Request Get Slides",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Placeholders": {
      "main": [
        [
          {
            "node": "Graph URL create",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d06091a6-bd35-4102-b940-b19ee46d66e4",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "bbebae8d6a8ec223e096c5f16922e3f9cd230a3402a93eda1f2057be674247c1"
  },
  "id": "ECSPk4UTC5DnnXFg",
  "tags": []
}